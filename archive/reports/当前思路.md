## 🏆 MCM 2026 Problem C: 最终系统架构与实施白皮书

### 0. 顶层设计哲学 (Design Philosophy)

在编写任何代码之前，全队必须在以下四个核心认知上达成一致：

1. **分治策略 (Divide & Conquer):** 严禁试图用一套公式算到底。**Percent 赛季**（连续变量）和 **Rank 赛季**（离散组合）必须使用两套完全不同的数学引擎。
2. **数据防御 (Defensive Engineering):** 假设数据是脏的（有退赛、有录入错误、有未记录的规则）。模型必须内建 **“松弛变量（Slack Variables）”** 和 **“有限状态机（FSM）”** 来自动消化异常，而不是报错崩溃。
3. **承认无知 (Uncertainty Quantification):** 既然是反演，就不存在“唯一解”。所有的输出必须是 **“区间（Interval）”** 或 **“分布（Distribution）”**，而非单一数值。
4. **因果优先 (Causal over Prediction):** Task 4 的目标不是预测比赛结果，而是解释“为什么赢”。拒绝黑盒模型（如 XGBoost），拥抱可解释的统计模型（如 Cox 生存分析）。

---

### 🧱 模块一：防御性数据工程 (Defensive ETL)

**目标：** 构建绝对正确的“Active Set”（活跃集/分母）。这是模型生死的基石。

#### 1.1 核心痛点 (The Pain Points)

- **退赛 (Withdrew):** 选手退赛那周，分数可能还在，但如果不剔除，分母偏大，导致推算出的粉丝票整体偏小。
- **0 分陷阱:** 有些选手没被淘汰但得了 0 分（数据异常或特殊规则），如果简单用 `Score > 0` 过滤，会丢失分母，导致约束失效。
- **双淘汰:** S5 等赛季存在一周淘汰两人的情况，标准逻辑会失效。

#### 1.2 解决方案：选手生命周期有限状态机 (FSM)

**执行标准：** 不要写 spaghetti code，建立一个标准的 FSM 类。

- **状态定义:** $S_{i,t} \in \{\text{Active}, \text{Eliminated\_This\_Week}, \text{Withdrew}, \text{Finalist}, \text{Inactive}\}$
- **状态流转逻辑 (必须写入代码):**
    
    1. **扫描 Result 列:** 解析 `Eliminated Week X`, `Withdrew`, `Winner`.
    2. **Withdrew 推断:** 由于数据中 `Withdrew` 无周数，推断规则为：找到该选手最后一个 `Judge_Score > 0` 的周 $T_{last}$，设退赛周 $T_{wd} = T_{last} + 1$。
    3. **周循环判定:**
        
        - **Week < T_end:** 状态 = `Active`。
            - **关键防御:** 即使当周 `Score=0` 或 `N/A`，只要没到淘汰周，**必须保留在分母中**（视为该选手得分为 0，占位分母）。
            - **例外:** 若全周所有人均为 N/A，标记为 `Skipped_Week`，跳过建模。
        - **Week == T_wd (退赛):** 状态 = `Inactive`。**立即移出分母**，不构建当周约束。
        - **Week == T_elim (淘汰):** 状态 = `Eliminated_This_Week`。**保留在分母中**，且作为约束不等式的**左边**（劣势方）。
        - **Week > T_end:** 状态 = `Inactive`。
            
    4. **周类型标记:**
        
        - 统计当周 `Eliminated_This_Week` 的人数 $K$。
        - $K=0 \to$ **No-Elim**; $K \ge 2 \to$ **Multi-Elim**。

#### 1.3 产出物

- **Active Matrix:** 一个 `(Season, Week, Contestant)` 的布尔掩码矩阵。
- **Event Log:** 自动生成的日志，记录“双淘汰周”、“无淘汰周”。

---

### ⚙️ 模块二：双核反演引擎 (The Dual-Core Inversion) —— 核心算力

**目标：** 反推粉丝票，解决 Task 1 & 3。

#### 2.1 引擎 A：Percent 赛季 (S3-S27) —— 两阶段鲁棒 LP

**适用:** 连续变量，线性约束 ($Total = J\% + F\%$)。

- **算法：Two-Phase Robust LP**
    - **约束构建 (Pairwise Constraints):** 严禁使用 Sum 比较 ($\sum E \le \sum S$)。必须使用成对约束：
        - 对于每一个淘汰者 $e \in E$ 和每一个幸存者 $s \in S$：

            $$F_e + J_e - s_{slack} \le F_s + J_s + s_{slack}$$

            _(物理意义：在容忍 $s$ 误差的情况下，任何一个淘汰者都比任何一个幸存者分低)_

    - **Phase 1 (一致性检测):**
        - 目标: $\min \sum |s_i|$ (L1-Norm)。
        - 输出: $S^*$ (最小不一致得分)。**这是 Task 1 要求的“一致性度量”。**
    - **Phase 2 (硬区间探测):**
        - 新增约束: $\sum |s_i| \le S^* + 10^{-6}$ (锁定违规量)。
        - 目标: 循环对每个选手 $i$，分别求解 $\min F_i$ 和 $\max F_i$。
        - 输出: $[L_i, U_i]$。**这是 Task 1 要求的“确定性度量”。**

#### 2.2 引擎 B：Rank 赛季 (S1-S2, S28+) —— 离散约束规划 (CP)

**适用:** 离散整数，Rank 组合。

- **算法：Google OR-Tools (CP-SAT)**
    - **变量:** $R_{fan} \in \{1, \dots, N\}$ (整数)。
    - **核心约束:** `AllDifferent(R_fan)` (不允许粉丝排名并列，或根据 Tie-break 规则允许有限并列)。
    - **逻辑约束:** $Total_E > Total_S$ (Rank 越大越差)。
    - **Tie-Breaker 探测:** 引入布尔变量 `is_judge_prior`，让数据自己决定该赛季是“评委优先”还是“粉丝优先”。
    - **降级策略 (Fallback):** 如果 CP 写不出来，回退到将 Rank 视为连续变量的 LP，并在论文中注明“Continuous Relaxation”。

#### 2.3 S28+ 特殊处理：并集多面体 (Union of Polytopes)

**解决 Judges' Save 导致的逻辑黑洞。**

- **核心逻辑:** S28 之后，被淘汰者 $E$ 的分数 **不一定** 是全场最低（因为倒数第一可能被救了）。
- **算法：迭代假设法 (Iterative Hypothesis)**
    
    1. 遍历 Active Set 中除 $E$ 外的每一个幸存者 $s_k$，假设 $s_k$ 是“被救者” (即 $s_k$ 实际上是倒数第一/二)。
    2. 构建虚拟约束：在假设 $k$ 下，$\{E, s_k\}$ 是倒数两名 $\rightarrow$ 这两人的分比其他人都低。
    3. **有效性判定:** 只要该假设下的 LP 有解 ($S^*$ 低)，就保留该解。
    4. **结果融合:** 最终的粉丝票可行域 = 所有成立假设下可行域的**并集 (Union)**。

---

### 🎲 模块三：贝叶斯采样与仿真 (MCMC & Simulation)

**目标:** 得到粉丝票的分布，完成 Task 2 & 3。

#### 3.1 采样算法：Dirichlet Hit-and-Run

- **雷点防御:** 必须保证 $\sum F_i = 1$ (Simplex Constraint)。
- **先验升级:** 使用 **Dirichlet Prior** $\text{Dir}(\alpha)$。
    - 设定 $\alpha_i = 1 + \lambda \cdot J_i$ ($\lambda$ 是相关系数)。
    - _解释:_ 假设粉丝审美与评委有弱相关性，而不是完全随机。这比均匀采样更符合社会学常识。
- **算法:** 在多面体内部进行 Hit-and-Run 游走，只保留满足 $\sum x=1$ 的样本。

#### 3.2 仿真实验：平行宇宙 (Counterfactuals)

**Task 2 核心:** 规则对比。

- **控制变量:** 假定引擎反演出的 $F$ 分布是真实的“潜在民意 (Latent Preference)”。
- **实验组 A (Rank):** 将 $F$ 转化成 Rank，按 S1 规则模拟淘汰。
- **实验组 B (Percent):** 将 $F$ 保持 Percent，按 S3 规则模拟淘汰。
- **关键指标:**
    - **颠覆率 (Reversal Rate):** 两种规则淘汰不同人的比例。
    - **流量保护度 (Fan Shielding):** “低评委分、高粉丝票”选手在 Percent 制下是否活得更久？

#### 3.3 Judges' Save 的边界测试

- **拒绝主观权重:** 不要去猜评委救人的概率公式。
- **三维情景分析:** 模拟三种极端：
    
    1. **唯技术论:** 评委 100% 救评委分高者。
    2. **唯流量论:** 评委 100% 救粉丝票高者。
    3. **随机:** 50/50。
        
- **结论:** 观察争议选手在三种极端情况下的存活率。

---

### 📉 模块四：统计归因与防泄露 (Attribution Analysis)

**目标:** Task 4，解释特征影响。

#### 4.1 核心痛点：循环论证与误差忽略

- **防泄露设计 (Leave-One-Out, LOO):**
    - 推断第 $t$ 周的 $F_t^{LOO}$ 时，**不使用第 $t$ 周的淘汰结果**作为约束。
    - 仅使用 $J_t$ (当周评委分) + $F_{t-1}$ (上周后验均值) 作为先验。
    - _解释:_ 这是“赛前预测的粉丝票”，用它来解释淘汰才具有因果效力。

#### 4.2 核心算法：Bootstrap Cox Model

- **误差传播 (Error Propagation):**
    - 从 MCMC 中抽取 100 组完整赛季的粉丝票样本。
    - 跑 100 次 **Cox Proportional Hazards** 模型。
    - 计算 100 个 **Hazard Ratio (HR)** 的均值和 95% 置信区间。
- **假设检验 (PH Test):**
    - 必须做 **Schoenfeld Residuals Test**。
    - _Story:_ 如果 Age 的 PH 检验失败，说明年龄的影响随时间变化（例如：老将前期容易被淘汰，后期反而因为情感分稳固）。

---

### ⚖️ 模块五：机制设计 (Mechanism Design)

**目标:** Task 5，提出新系统。

#### 方案：分层阈值系统 (Tiered Threshold System)

**设计哲学:** "Professional Floor, Popular Ceiling" (专业的底线，大众的天花板)。

1. **软熔断 (Soft Floor):**
    
    - **规则:** 若选手评委分低于全场均值 $2\sigma$，粉丝票权重打折 (e.g., $\times 0.5$)。
    - _针对痛点:_ 防止“跳得烂但人气高”的选手挤占名额。
        
2. **精英混合 (Elite Mix):**
    
    - **规则:** 过了熔断线后，采用 **Rank (40%) + Percent (60%)** 混合。
    - _针对痛点:_ Rank 防止票数垄断，Percent 奖励超高人气，各取所长。
        
3. **信号释放 (Signaling):**
    
    - **规则:** 每周直播公布“安全区”名单（不公布具体票数）。
    - _针对痛点:_ 引入博弈论信号，刺激落后选手的粉丝打榜，增加悬念。

---

### 📊 必做图表清单 (The Money Plots)

1. **"Ghost in the Data" (幽灵数据图):**
    
    - X 轴赛季，Y 轴粉丝票权重反演区间（箱线图）。
    - _Story:_ 标注出规则改变的年份。如果 S28 之后 Boxplot 变宽，说明规则变得更模糊/主观。
    
2. **"The Inconsistency Spectrum" (不一致光谱):**
    
    - X 轴赛季，Y 轴 Phase 1 的 $S^*$ (Inconsistency Score)。
    - _Story:_ S28 之后 $S^*$ 飙升，直观证明 Judges' Save 引入了大量数学上的不一致性（即人为干预）。
    
3. **"Hazard Ratio Forest" (风险森林图):**
    
    - 展示 Pro Dancer, Age, Score 的 HR 及置信区间。
    - _Story:_ Pro Dancer 的 HR 显著小于 1，证明好舞伴是保命符。
    
4. **"Reversal Rate Heatmap" (反事实热力图):**
    
    - 展示不同赛季应用不同规则后的结果差异率。颜色越深，说明赛制改变的影响越大。

---

#### 🚀 避坑指南 (Final Checklist)

1. **数据清洗必须极度偏执：** 0 分和 N/A 是两个概念，Withdrew 必须推断周数。这里错了，后面全错。
2. **算法必须分治：** S1 用 CP，S3 用 LP，S28 用并集。不要试图用一把钥匙开三把锁。
3. **遇到无解不要慌：** $S^*$ 飙升本身就是结论——证明了赛制的主观性。将“模型报错”转化为“论文论点”。
