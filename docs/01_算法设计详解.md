# 模型一：算法设计（新版框架）

**版本**：4.0  
**日期**：2026-01-31  
**目标**：在公开评分规则下，以“硬约束反演 + 贝叶斯采样 + 反事实评估”的闭环，恢复粉丝意愿并量化赛制公平性。

---

## 1. 核心概念
为避免逻辑循环，模型将“规则正确”与“人气偏离”拆分：

- **规则一致性（硬约束）**：任何有效样本必须复现实测淘汰结果。
- **人气偏离（审计指标）**：在规则一致的样本中，淘汰者是否并非最低粉丝票。

数学表达：

\[
\text{Outcome}_{\text{sim}} \equiv \text{Outcome}_{\text{obs}}
\]
\[
\text{IsWrongful} \iff V_{\text{fan, elim}} > \min_i V_{\text{fan, i}}
\]

---

## 2. 输入与输出
**输入**：
- 赛季与周次的评委分数/排名、淘汰结果、赛制规则。

**输出**：
- 每周粉丝票区间 \([L_i, U_i]\) 与点估计。
- 后验均值与 95% HDI 区间（时间平滑后的粉丝票曲线）。
- 反事实评估指标（Kendall’s Tau / 逆转率 / 孔多塞一致性）。
- 机制设计帕累托前沿与动态权重方案。

---

## 3. 算法结构
### 3.1 数据工程与活跃集
- 清洗选手 ID、赛季周次、淘汰/退赛标签。
- 构建每周活跃集与淘汰/生还关系。

### 3.2 层 2：硬约束反演
- **百分制赛季（S3–S27）**：线性规划（LP）反演粉丝票区间。
- **排名制赛季（S1–S2, S28+）**：混合整数规划（MILP）反演排名约束。

输出：每周每位选手的可行区间 \([L_i, U_i]\)。

### 3.3 层 3：截断贝叶斯 + MCMC
- 在区间上构造截断先验（Dirichlet）。
- 用 MCMC 采样并引入时间平滑先验，约束相邻周票数突变。
- 采样后执行**规则一致性过滤**，只保留能复现实测淘汰的样本。

输出：后验均值与 95% HDI 区间。

---

## 4. 反事实评估（Task 2）
- 固定粉丝意愿与评委分数，替换规则引擎。
- 计算三类指标：
  - **Kendall’s Tau**（排名一致性）
  - **逆转率**（机制淘汰 vs 观众淘汰）
  - **孔多塞一致性**（是否淘汰“粉丝赢家”）

---

## 5. 机制设计（Task 4）
- 目标：同时最大化“评委一致性（技术公平）”与“观众一致性（参与度）”。
- 采用**动态自适应权重**：
  - 前期（Week 1–5）偏评委（\(\alpha \approx 0.7\)）
  - 后期逐步向观众倾斜（\(\alpha \to 0.4\)）
- 通过帕累托前沿寻找“甜蜜点”。

---

## 6. 特征分析（Task 3）
- **模型**：XGBoost 回归，预测“存活周数”。
- **解释**：SHAP 重要性与依赖图，输出高维交互影响。

---

## 7. 产出文件
- `outputs/fan_vote_intervals.csv`
- `outputs/fan_vote_posterior_summary.csv`
- `outputs/counterfactual_summary.csv`
- `outputs/counterfactual_summary_dynamic.csv`
- `outputs/pareto_frontier.csv`
- `outputs/feature_importance.csv`
- `figures/fig_q1_uncertainty_heatmap.pdf`
- `figures/bobby_bones_survival.png`
- `figures/fig_pareto_frontier.pdf`
- `figures/fig_shap_summary.pdf`

---

## 8. 关键脚本
- `scripts/run_full_pipeline.py`：完整流程一键执行
